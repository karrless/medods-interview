# Music library API for Effective Mobile GO interview

# Установка
1. Создать `.env` файл в корне на примере `exapmle.env`:
    ```
    POSTGRES_HOST=postgres # Оставьте postrgres, для корректонопо подключения к контейнеру в docker compose
    POSTGRES_PORT=5432 # PostgreSQL порт
    POSTGRES_USER=postgres # PostgreSQL пользователь
    POSTGRES_PASSWORD=asutp93~~ # PostgreSQL пароль
    POSTGRES_DB=medods_interview # PostgreSQL имя базы данных
    POSTGRES_SSLMODE=disable # PostgreSQL ssl режим

    SERVER_HOST=localhost # Хост сервера используется лишь в метаданных
    SERVER_PORT=8080 # Порт сервера, будет как внутри docker, так и снаружи
    DEBUG=false # Дебаг режим

    SHA512KEY=your_secret_key #Ключ для шифрования
    ```
2. Запустить `docker-compose`:
   ```
   docker-compose up --build
   ```

# Использование
По адресу `localhost:%ваш_порт%/swagger/index.html` будет swagger документация для api с возможностью протестировать сервис.

# Особенности
1. Был реализован лишь функционал, указанный в ТЗ, т.е., например, создание и редактирование пользователя, logout, проверка access токена реализованы не были, - лишь выдача пары Access и Refresh токенов, а также Refresh.
2. База данных с именем, указанным в `.env`, автоматически создатся сама, но в ней не будет записей, потому для тестирования работоспособности необходимо будет вручную создать записи.
3. Из-за того, что bcrypt подразумевает под собой генерирование случайной соли, что делает невозможным поиск пользователя по refresh токену в базе данных, было принято решение сделать дополнительный public токен, который никак не хэшируется, и по которому и идёт поиск в базе данных. При этом проерка refresh токена никуда не делась, потому непосредственно функционала и безопасности данное решение не коснулось
4. Как было разрещено в тз, отправка email warning не была реализована, вместо этого в консоль выводится лог об отправке email warning

# База данных
1. Таблица `users`:
   1. `guid` - primary key поле с GUID пользователя
   2. `email` - not null поле с почтой (валидация почты на стороне бд не реализована)
   3. `IP` - inet not null поле с ip пользователя
2. Таблица `tokens`:
   1. `guid` - primary key поле с GUID пользователя foreign key от `user.GUID`
   2. `refresh_token` - unique not null поле с bcrypt хэшом refresh токеном
   3. `public_token` - unique not null поле с незахэшированным public токеном

# Предложение по улушчению
1. Сделать TTL для Refresh и Access токенов (это не было реализовано в связи с тем, что не указано в ТЗ)
2. Сделать возможнолсть отозвать refresh токен.
3. Для хранения токенов использовать Redis или аналог, если позволяет память, из-за большей производительности, а также наличия встроенного TTL
4. Добавить SHA512 ключ в более надежное хранилище, чем переменные окружения (например HashiCorp Vault или использовать Docker secrets)
